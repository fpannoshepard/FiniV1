<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>BA Swap</title>
<style>
:root{
  --blue:#2f7bff;
  --blue2:#0a5bff;
  --danger:#ff3b3b;
  --warn:#ffcc66;
  --text:#eaf0ff;
}

body{
  margin:0;
  font-family:Arial, sans-serif;
  background:#0b1022;
  color:var(--text);
}

header{
  display:flex;
  justify-content:space-between;
  align-items:center;
  padding:16px 24px;
  background:#111827;
}

.logo{
  width:40px;height:40px;
  background:linear-gradient(135deg,#000 50%,var(--blue) 50%);
  border-radius:8px;
}

button{
  padding:10px 14px;
  border:none;
  border-radius:8px;
  cursor:pointer;
  font-weight:bold;
}

.primary{
  background:var(--blue);
  color:white;
}

.card{
  max-width:500px;
  margin:60px auto;
  padding:20px;
  background:#111827;
  border-radius:16px;
}

.modal-backdrop{
  position:fixed;
  inset:0;
  background:rgba(0,0,0,.7);
  display:none;
  justify-content:center;
  align-items:center;
}

.modal{
  background:#111827;
  padding:20px;
  border-radius:16px;
  max-width:520px;
  width:90%;
}

.modal h3{
  margin-top:0;
}

.modal-footer{
  margin-top:20px;
  display:flex;
  gap:10px;
}

.ticon{
  display:inline-flex;
  align-items:center;
  justify-content:center;
  width:28px;height:28px;
  border-radius:8px;
  background:rgba(47,123,255,.2);
  margin-right:8px;
  font-weight:bold;
}
</style>
</head>
<body>

<header>
  <div style="display:flex;align-items:center;gap:10px;">
    <div class="logo"></div>
    <div>
      <div style="font-weight:bold;">BA Swap</div>
      <div style="font-size:12px;opacity:.6;">Demo Decentralized Exchange Interface</div>
    </div>
  </div>
  <button class="primary" id="connectBtn">Blockchain Association</button>
</header>

<div class="card" id="connectCard">
  <h2>Connect to Continue</h2>
  <button class="primary" onclick="showCompliance()">Connect Wallet</button>
</div>

<div class="card" id="swapCard" style="display:none;">
  <h2>Swap</h2>

  <div>
    <button onclick="openTokenPicker('from')">Select From Token</button>
    <span id="fromDisplay"></span>
  </div>

  <div style="margin-top:10px;">
    <button onclick="openTokenPicker('to')">Select To Token</button>
    <span id="toDisplay"></span>
  </div>

  <div style="margin-top:10px;">
    <button onclick="openRecipientPicker()">Select Counterparty</button>
    <span id="recipientDisplay"></span>
  </div>

  <div style="margin-top:20px;">
    <input type="number" id="amount" placeholder="Amount">
  </div>

  <div style="margin-top:20px;">
    <button class="primary" onclick="executeSwap()">Swap</button>
  </div>
</div>

<!-- Modal -->
<div class="modal-backdrop" id="modalBackdrop">
  <div class="modal">
    <h3 id="modalTitle"></h3>
    <div id="modalBody"></div>
    <div class="modal-footer" id="modalFooter"></div>
  </div>
</div>

<script>
const TOKENS = ["ETH","USDC","BTC","A7A5","McLarencoin","Murphycoin","Dutchcoin","Germcoin","Sprucecoin","Nistlercoin","Meadowlarkcoin"];
const ICONS = {
  ETH:"Ξ",
  USDC:"U",
  BTC:"₿",
  A7A5:"A7",
  McLarencoin:"MC",
  Murphycoin:"MU",
  Dutchcoin:"DU",
  Germcoin:"GE",
  Sprucecoin:"SP",
  Nistlercoin:"NI",
  Meadowlarkcoin:"ME"
};

let fromToken=null;
let toToken=null;
let recipient=null;

const $ = id => document.getElementById(id);
let modalCloseTimer = null;

/* ===== MODAL FIXED ===== */
function openModal({title, body, buttons}) {

  if (modalCloseTimer) {
    clearTimeout(modalCloseTimer);
    modalCloseTimer = null;
  }

  $("modalTitle").innerText = title;
  $("modalBody").innerHTML = body;

  const footer = $("modalFooter");
  footer.innerHTML = "";

  buttons.forEach(b => {
    const btn = document.createElement("button");
    btn.innerText = b.label;
    btn.className = b.primary ? "primary" : "";
    btn.onclick = b.onClick;
    footer.appendChild(btn);
  });

  $("modalBackdrop").style.display = "flex";
}

function closeModal(immediate=false) {

  if (modalCloseTimer) {
    clearTimeout(modalCloseTimer);
    modalCloseTimer = null;
  }

  if (immediate) {
    $("modalBackdrop").style.display = "none";
    return;
  }

  modalCloseTimer = setTimeout(() => {
    $("modalBackdrop").style.display = "none";
    modalCloseTimer = null;
  }, 150);
}

/* ===== Compliance ===== */
function showCompliance(){
  openModal({
    title:"Analytics Firms such as Chainalysis are now screening your wallet address against U.S. sanctions lists, including those maintained by the Office of Foreign Assets Control (OFAC), as well as datasets that associate addresses with illicit activity.",
    body:"<p>If an address is identified as a sanctioned entity, it is blocked from further interacting with the interface.</p>",
    buttons:[
      {label:"Continue", primary:true, onClick:()=>{
        closeModal(true);
        $("connectCard").style.display="none";
        $("swapCard").style.display="block";
      }}
    ]
  });
}

/* ===== Token Picker ===== */
function openTokenPicker(type){
  let list = TOKENS.map(t => `
    <div onclick="selectToken('${type}','${t}')" style="padding:8px;cursor:pointer;">
      <span class="ticon">${ICONS[t]}</span>${t}
    </div>
  `).join("");

  openModal({
    title:"Select Token",
    body:list,
    buttons:[{label:"Close", onClick:()=>closeModal(true)}]
  });
}

function selectToken(type, token){
  closeModal(true);
  setTimeout(()=>{
    if(type==="from"){ fromToken=token; $("fromDisplay").innerText=token; }
    else { toToken=token; $("toDisplay").innerText=token; }

    maybeWarn(token);
  },0);
}

/* ===== Recipient Picker ===== */
function openRecipientPicker(){
  let list = ["Lindsay","Brian"].map(r=>`
    <div onclick="selectRecipient('${r}')" style="padding:8px;cursor:pointer;">${r}</div>
  `).join("");

  openModal({
    title:"Select Counterparty",
    body:list,
    buttons:[{label:"Close", onClick:()=>closeModal(true)}]
  });
}

function selectRecipient(name){
  closeModal(true);
  setTimeout(()=>{
    recipient=name;
    $("recipientDisplay").innerText=name;
  },0);
}

/* ===== WARNINGS ===== */
function maybeWarn(token){

  if(token==="A7A5"){
    openModal({
      title:"Not available",
      body:"Unavailable at this time: A7A5 is linked to sanctioned entities.",
      buttons:[{label:"Close",primary:true,onClick:()=>closeModal()}]
    });
  }

  if(token==="McLarencoin"){
    openModal({
      title:"Malicious token detected",
      body:"Flagged as malicious.",
      buttons:[
        {label:"Go back",onClick:()=>closeModal()},
        {label:"Continue",primary:true,onClick:()=>closeModal()}
      ]
    });
  }

  if(token==="Murphycoin"){
    openModal({
      title:"100% sell fee detected",
      body:"Charges 100% fee when sold.",
      buttons:[
        {label:"Go back",onClick:()=>closeModal()},
        {label:"Continue",primary:true,onClick:()=>closeModal()}
      ]
    });
  }
}

/* ===== Swap ===== */
function executeSwap(){
  if(recipient==="Brian"){
    openModal({
      title:"Transaction blocked",
      body:"Blockaid has simulated this transaction before it has been executed and determined that the order called by you and executed by the counterparty are different. This transaction and all associated funds have been frozen",
      buttons:[{label:"Close",primary:true,onClick:()=>closeModal()}]
    });
    return;
  }

  if(recipient==="Lindsay"){
    document.body.innerHTML = `
      <div style="text-align:center;margin-top:100px;">
        <h1>CONGRATS! YOU PASSED MARKET STRUCTURE</h1>
        <img src="https://images.pexels.com/photos/19191521/pexels-photo-19191521.jpeg" style="width:80%;margin-top:20px;">
      </div>
    `;
  }
}
</script>
</body>
</html>
